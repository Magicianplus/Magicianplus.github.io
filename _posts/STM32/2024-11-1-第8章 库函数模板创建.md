---
layout: post
title: "第8章 库函数模板创建"
category: STM32
---

<center><font face = "楷体" size = 6 color = orange>第8章 库函数模板创建</font></center>

### 一、固件库的获取
1. ST官网获取：https://www.st.com/content/st_com/en/products/embedded-software/mcu-mpu-embedded-software/stm32-embedded-software/stm32-standard-peripheral-libraries/stsw-stm32054.html
2. 找作者要资料

### 二、创建库函数工程
1. 工程文件夹中要包含User、Obj、Libraries
2. **User：** 存放用户文件、包括main、main.c、STM32的一个头文件、配置文件、中断文件等
3. **Obj：** 编译器产生的一些中间文件，如汇编链接的一些链表文件、调试信息、Hex文件（使用串口下载程序的时候，要定位到Obj文件夹下的Hex文件，烧写到芯片当中进行运行）
4. **Libraries：** STM32库文件，包括CMSIS的一些外设库文件都放在这个文件夹下

#### Libraries文件夹
1. Libraries文件夹包含：CMSIS、STM32F10x_StdPeriph_Driver（外设驱动文件夹）
2. **CMSIS：** 用来存放CMSIS标准的一些文件、启动文件
**CMSIS里面要存放M3内核通用文件**

[![pADhtt1.png](https://s21.ax1x.com/2024/11/01/pADhtt1.png)](https://imgse.com/i/pADhtt1)
**系统初始化文件及其头文件**

[![pADhDne.png](https://s21.ax1x.com/2024/11/01/pADhDne.png)](https://imgse.com/i/pADhDne)
**启动文件**
hd.s：代表STM3210系列高容量的芯片使用的启动文件（ZET6）
md.s：中等容量（VCT6、VET6等）
ld.s：低容量（C8T6）

[![pADhIBQ.png](https://s21.ax1x.com/2024/11/01/pADhIBQ.png)](https://imgse.com/i/pADhIBQ)

3. **STM32F10x_StdPeriph_Driver文件夹**：存放外设驱动文件

[![pAD4mHH.png](https://s21.ax1x.com/2024/11/01/pAD4mHH.png)](https://imgse.com/i/pAD4mHH)
官方提供的里面有src和inc，src是源文件，inc是与源文件对应的头文件，将两个文件夹直接复制进去

#### User文件夹
**头文件**

[![pAD4rvT.png](https://s21.ax1x.com/2024/11/01/pAD4rvT.png)](https://imgse.com/i/pAD4rvT)
**中断文件、配置文件、main.c文件**

[![pAD4526.png](https://s21.ax1x.com/2024/11/01/pAD4526.png)](https://imgse.com/i/pAD4526)

#### Obj文件夹
需要在Keil环境设置时将它的一些中间文件生成路径定位到Obj文件夹下

### 三、新建工程
1. 打开Keil软件

[![pA0itcF.png](https://s21.ax1x.com/2024/10/26/pA0itcF.png)](https://imgse.com/i/pA0itcF)
2. 新建工程
命名不要使用中文或特殊符号，要使用英文

[![pAD4xRP.png](https://s21.ax1x.com/2024/11/01/pAD4xRP.png)](https://imgse.com/i/pAD4xRP)

- **选择好型号（选择自己使用的型号），点击OK**

[![pA0igje.png](https://s21.ax1x.com/2024/10/26/pA0igje.png)](https://imgse.com/i/pA0igje)
   - 弹出的窗口是一些运行环境，不需要管，点击取消

[![pA0iRnH.png](https://s21.ax1x.com/2024/10/26/pA0iRnH.png)](https://imgse.com/i/pA0iRnH)
- 这样工程已经添加好，工程名称也已经定义了，这个是一个工程文件，以后打开文件打开这个即可

[![pAD59sS.png](https://s21.ax1x.com/2024/11/01/pAD59sS.png)](https://imgse.com/i/pAD59sS)
Temptlate是刚才新建的工程文件名，之后打开工程直接双击文件即可

1. **加载需要的文件**
- 方法一：

[![pA0ixNq.png](https://s21.ax1x.com/2024/10/26/pA0ixNq.png)](https://imgse.com/i/pA0ixNq)
- 方法二：双击`Sourse`，定位到`User`文件夹，进行添加
- 方法三：点击上方管理项目文件

[![pA0AbjO.png](https://s21.ax1x.com/2024/10/26/pA0AbjO.png)](https://imgse.com/i/pA0AbjO)

4. 重新命名工程组（添加目录）
里面有User、Startup（启动文件）、CMSIS（存放CMSIS标准的文件：M3的内核文件、SystemInit初始化时钟文件）、StdPeriph_Drivre（标准外设驱动文件）
[![pArVKCd.png](https://s21.ax1x.com/2024/11/02/pArVKCd.png)](https://imgse.com/i/pArVKCd)

5. 文件添加
**User文件添加**
[![pArVM8A.png](https://s21.ax1x.com/2024/11/02/pArVM8A.png)](https://imgse.com/i/pArVM8A)
**Startup（启动文件）文件添加**
[![pArVQgI.png](https://s21.ax1x.com/2024/11/02/pArVQgI.png)](https://imgse.com/i/pArVQgI)
**CMSIS文件添加**
[![pArVlvt.png](https://s21.ax1x.com/2024/11/02/pArVlvt.png)](https://imgse.com/i/pArVlvt)
**StdPeriph_Drivre文件添加**
只需要添加源文件，直接包含头文件的路径就ok，根据我们指示的路径自动调用它的头文件，就不需要添加头文件了。
编译的时候，所有的源文件都要编译一遍，使用工程的时候不一定需要全部的外设，为了使工程更加的精简，所以需要哪个外设添加哪个外设的文件进来，不需要全添加，全添加会占用电脑的内存
简单外设添加举例
[![pArV3KP.png](https://s21.ax1x.com/2024/11/02/pArV3KP.png)](https://imgse.com/i/pArV3KP)