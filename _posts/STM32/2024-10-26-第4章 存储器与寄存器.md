---
layout : post
title: "第4章 存储器与寄存器"
category: STM32
---

<center><font face = "仿宋" size = 6 color = orange>第4章 存储器与寄存器</font></center>

### 一、存储器映射
1. 存储器是不具备地址信息的，地址是由芯片厂商和用户进行分配，给存储器分配地址的过程称为**存储器映射**，再分配一个地址就叫**重映射**。
2. **STM32芯片存储器映射图**

[![pAwuilt.png](https://s21.ax1x.com/2024/10/24/pAwuilt.png)](https://imgse.com/i/pAwuilt)
- 从图中可以看出ARM将4GB分为了8块，block0——block7，每一块512Mb
- 其中block0：包含了STM32芯片内部的Flash。这一块内存主要用来设计芯片的Flash，ZET6为512K的Flash，要集成更大的Flash和SRAM，意味着芯片的成本就要增加，所以往往片内集成的Flash不会太大
- block1：包含SRAM（64KB）
- block2：包含了STM32的一些片内外设资源

3. **存储器区域划分**

[![pAwuG0U.png](https://s21.ax1x.com/2024/10/24/pAwuG0U.png)](https://imgse.com/i/pAwuG0U)

### 二、寄存器和寄存器映射
1. 存储器内部4个字节为1个单元，每个单元对应不同的功能，当我们要控制对应的单元的时候，就要控制对应的外设，每一个单元还对应一个地址，操作这些单元就是要对这些地址进行访问
2. 由于STM32的外设非常多，而且复杂，如果每操作一个外设，就要写一大串对应的存储单元的地址，非常麻烦，容易写错。
3. 因此，我们把每个单元的功能作为名，给这个内存取一个别名，这个别名就是我们经常说的**寄存器**。通过C语言指针操作这个寄存器，就可以实现访问它的内容。寄存器即有特定功能的内存单元。
4. **寄存器映射：**给已经分配好地址的有特定功能的内存单元取别名的过程就叫寄存器映射。

### 三、基地址
1. 访问STM32的寄存器就是操作这些内存单元，通常会用指针操作STM32的内存单元
2. 片上外设区分为4条总线，根据外设速度的不同，不同总线上面挂着不同的外设
   - APB1挂载着低速的外设
   - APB2和AHB挂载着高速的外设
3. 相应总线的最低地址称之为总线的基地址
[![pAwT5HH.png](https://s21.ax1x.com/2024/10/26/pAwT5HH.png)](https://imgse.com/i/pAwT5HH)
   - 圈住部分为APB1总线的基地址
   - 0x40000400比基地址增加的值称为偏移地址（相对于基地址的偏移地址）
   - 偏移量：两个地址相减
4. **STM32总线地址如下：**
[![pAwT74I.png](https://s21.ax1x.com/2024/10/26/pAwT74I.png)](https://imgse.com/i/pAwT74I)
5. **GPIO外设地址如下：**
[![pAwTbCt.png](https://s21.ax1x.com/2024/10/26/pAwTbCt.png)](https://imgse.com/i/pAwTbCt)

### 四、外设寄存器地址
1. 我们以 GPIOB 端口为例，来说明GPIO都有哪些寄存器：
[![pAwTOv8.png](https://s21.ax1x.com/2024/10/26/pAwTOv8.png)](https://imgse.com/i/pAwTOv8)
2. **手册怎么使用**
[![pAwTxbQ.png](https://s21.ax1x.com/2024/10/26/pAwTxbQ.png)](https://imgse.com/i/pAwTxbQ)
   - 1为寄存器名称
   - 2为数字序号，代表寄存器的每一个位，一个寄存器占用4个字节，32位，所以从0-31，一共32位
   - 3为方框中的内容，可以参考下面表格找到对应的功能
   - 4是方框下方的字母，代表权限，w表示只写，r代表只能读，rw表示可读可写
   - 5是表格中的内容，是介绍每一个位它具体的含义

