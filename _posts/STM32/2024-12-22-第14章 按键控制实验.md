---
layout: post
title: "第14章 按键控制实验"
category: STM32
---

<center><font face = "楷体" size = 6 color = orange>第14章 按键控制实验</font></center>

### 一、按键介绍

[![pAO9cFS.png](https://s21.ax1x.com/2024/12/19/pAO9cFS.png)](https://imgse.com/i/pAO9cFS)

按键就是一种电子开关使用时轻轻按开关按钮就可以使开关接通，当松开手的时候，开关断开。说白了按键就是用来实现一个电路的通路以及断开操作的开关。

#### 如何接线
假设我们接的是1，3，此时电路一直是通路，当我们按下按键和不按下按键都是同一个结果，因为1，3相连引脚初始是导通的，那我们不能实现按键操作。所以我们应该接1，2引脚，同样的我们也可以接1，4引脚

#### 按键抖动
1. 通常的按键所用开关为机械弹性开关，当机械触点断开、闭合时，电压信号如图：

[![pAOAswn.png](https://s21.ax1x.com/2024/12/19/pAOAswn.png)](https://imgse.com/i/pAOAswn)

2. 当按键按下立刻变为低电平，松开的时候立刻变为高电平，这是理想状态的波形。实际上，机械开关在安下或者松开的时候有一个抖动，等到一定时间后他就会稳定，抖动时间通常是**10 ~ 20ms**。
3. 需要消除抖动的波形，抖动过程中产生低电平，会导致设备误操作，所以需要对进行按键滤波。
4. 按键的滤波方法：
   - 硬件消抖：通过RC的滤波电路，通过充放电，实现时间的滤除
   - 软件消抖：使用延时

### 二、硬件设计

[![pAOEN7R.png](https://s21.ax1x.com/2024/12/19/pAOEN7R.png)](https://imgse.com/i/pAOEN7R)

开发板上一共有4个按键：
   - KEY_UP：PA0，按键按下检测到有效电平是3.3V，高电平有效
   - KEY0：PE4，按键按下检测到低电平有效
   - KEY1：PE3，按键按下检测到低电平有效
   - KEY2：PE2，按键按下检测到低电平有效

### 三、软件设计
#### 程序主要框架：
1. 初始化按键使用的端口及时钟
2. 按键检测处理
2. 按键控制处理

### 创建文件
1. 在APP文件夹下创建KEY文件夹，用来存放按键文件
2. 在KEY文件夹下创建key.h和key.c文件
3. 进行按键初始化时，和LED、蜂鸣器时类似的，但是需要用到GPIO的输入功能，当按键按下的时候，检测端口引脚是高电平还是低电平